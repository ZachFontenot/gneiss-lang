-- Mutual recursion with <|> operator

type ParseResult a =
    | Parsed a
    | ParseFail String

let run_parser p input = p ()

let (<|>) p1 p2 =
    fun () ->
      shift (fun k ->
        match run_parser p1 () with
        | Parsed v -> k v
        | ParseFail _ -> run_parser p2 ()
    )

let rec foo () =
    bar 1

and bar x =
    (fun () -> x + 1) <|> (fun () -> x)

let main () =
    print "test"
